name: Label PR

on:
  pull_request:
    types: [opened, synchronize, reopened]

permissions:
  contents: read
  pull-requests: write

jobs:
  path-labeler:
    name: Path Labels
    runs-on: ubuntu-latest
    steps:
      - uses: actions/labeler@v6
        with:
          configuration-path: .github/labeler.yml

  title-labeler:
    name: Title Labels
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v7
        with:
          script: |
            const title = context.payload.pull_request.title;
            const prefixMap = {
              feat: 'feature',
              fix: 'bug',
              docs: 'documentation',
              style: 'style',
              refactor: 'refactor',
              perf: 'performance',
              ci: 'ci',
              chore: 'chore',
            };
            const labels = [];
            for (const [prefix, label] of Object.entries(prefixMap)) {
              if (title.startsWith(`${prefix}:`)) {
                labels.push(label);
                break;
              }
            }
            if (labels.length > 0) {
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.pull_request.number,
                labels,
              });
            }
